<!DOCTYPE html>
<html lang="en" xmlns:th="https://www.thymeleaf.org">
  <head th:replace="../fragments/header"> </head>

  <body class="background-grey">
    <div class="defaultMargin py-3">
      <span class="directory-link">
        <a class="directory-link" th:href="@{/}">Home</a>
        <span class="mx-1">></span>
        <a class="directory-link" th:href="@{/store/1}">Products</a>
        <span class="mx-1">></span>
        <a class="directory-link-active" th:text="${product.productName}" th:href="@{|/product/${product.id}|}"></a>
      </span>
    </div>
    <div class="defaultMargin row">
      <div class="col-9 mb-4">
        <div class="product-details-item p-4">
          <!-- <img
            th:src="${product.image}"
            th:alt="${product.productName + '-img.png'}"
          /> -->
          <img th:alt="${product.productName + '-img.png'}" />
          <h3 class="product-name" th:text="${product.productName}"></h3>
          <p class="product-description" th:text="${product.description}"></p>
          <p class="product-status" th:text="${product.status}"></p>
          <p class="product-category" th:text="${product.category}"></p>
          <p class="product-price" th:text="${'â‚± ' + product.price}"></p>
          <p th:text="${'Number of sold: ' + product.numberOfSold}"></p>
    
          <div class="product-tags">
            <div th:each="tag : ${product.tags}">
              <p th:text="${tag}"></p>
            </div>
          </div>

          <form
            th:action="@{/addToWishlist}"
            method="post"
            th:if="${userRole == 'USER' || userRole == 'ADMIN'}"
          >
            <input type="hidden" name="productId" th:value="${product.id}" />
            <button type="submit">
              <img
                alt="wishlist-img"
                th:if="${inUserWishlist != true}"
                th:src="${'/img/bookmark_border_black_24dp.svg'}"
              />
              <img
                alt="wishlist-img"
                th:if="${inUserWishlist == true}"
                th:src="${'/img/bookmark_black_24dp.svg'}"
              />
            </button>
          </form>

          <div
            th:each="i : ${#numbers.sequence(1, product.rating)}"
            style="display: inline-block"
          >
            <form th:action="@{/rate}" method="POST">
              <input type="hidden" name="rating" th:value="${i}" />
              <input type="hidden" name="productId" th:value="${product.id}" />
              <button type="submit" class="btn-star">
                <img
                  alt="star-img"
                  th:src="${'/img/star_black_24dp.svg'}"
                  class="star-filled"
                />
              </button>
            </form>
          </div>

          <div
            th:if="${product.rating < 5}"
            th:each="i : ${#numbers.sequence(1, 5 - product.rating)}"
            style="display: inline-block"
          >
            <form th:action="@{/rate}" method="POST">
              <input
                type="hidden"
                name="rating"
                th:value="${i + product.rating}"
              />
              <input type="hidden" name="productId" th:value="${product.id}" />
              <button type="submit" class="btn-star">
                <img
                  alt="star-img"
                  th:src="${'/img/star_border_black_24dp.svg'}"
                  class="star-empty"
                />
              </button>
            </form>
          </div>

          <p th:if="${!didUserBuyProduct}">
            Buy the product first before rating.
          </p>
        </div>
        <div class="product-details-item p-4">
          <form th:action="@{/addProduct}" method="post">
            <input
              type="number"
              id="product-quantity"
              name="productQuantity"
              min="1"
              max="5"
              value="1"
            />
            <button
              type="submit"
              class="add-to-cart"
              name="productId"
              th:value="${product.id}"
            >
              Add to cart
            </button>
          </form>
          <div id="comments">
            <h3>COMMENTS</h3>
            <div th:if="${product.comments.empty}">No Comments</div>
            <div class="comment" th:each="comment : ${product.getComments()}">
              <div>
                <img src="#" alt="user-img.png" />
                <h4 th:text="${comment.userName}"></h4>
              </div>
              <p th:text="${comment.userComment}"></p>
            </div>
          </div>
      
          <div th:if="${!didUserBuyProduct}">
            Buy the product to make a comment.
          </div>
          <form th:action="@{/comment}" method="post" th:if="${didUserBuyProduct}">
            <section>
              <h4>MAKE A COMMENT</h4>
              <textarea
                id="user-comment"
                name="userComment"
                style="resize: none"
              ></textarea>
            </section>
            <button name="productId" type="submit" th:value="${product.id}">
              SUBMIT
            </button>
          </form>
      
          <button><a th:href="@{/store/1}">GO BACK</a></button>
        </div>
      </div>
    </div>
    <div th:replace="../fragments/footer.html"></div>
  </body>
</html>
